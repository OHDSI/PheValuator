\PassOptionsToPackage{unicode=true}{hyperref} % options for packages loaded elsewhere
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provides euro and other symbols
\else % if luatex or xelatex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={EvaluatingPhenotypeAlgorithms},
  pdfauthor={Joel N. Swerdel},
  pdfborder={0 0 0},
  breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
  \let\oldparagraph\paragraph
  \renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
  \let\oldsubparagraph\subparagraph
  \renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

% set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother


\title{EvaluatingPhenotypeAlgorithms}
\author{Joel N. Swerdel}
\date{2020-03-21}

\begin{document}
\maketitle

{
\setcounter{tocdepth}{3}
\tableofcontents
}
\newpage

\hypertarget{introduction}{%
\section{Introduction}\label{introduction}}

The \texttt{Phevaluator} package enables evaluating the performance
characteristics of phenotype algorithms (PAs) using data from databases
that are translated into the Observational Medical Outcomes Partnership
Common Data Model (OMOP CDM).

This vignette describes how to run the PheValuator process from start to
end in the \texttt{Phevaluator} package.

\hypertarget{overview-of-process}{%
\section{Overview of Process}\label{overview-of-process}}

There are several steps in performing a PA evaluation: 1. Creating the
extremely specific (xSpec), extremely sensitive (xSens), and prevalence
cohorts 2. Creating the Diagnostic Predictive Model using the
PatientLevelPrediction (PLP) package 3. Creating the Evaluation Cohort
4. Creating the Phenotype Algorithms for evaluation 5. Evaluating the
PAs 6. Examining the results of the evaluation

Each of these steps is described in detail below. For this vignette we
will describe the evaluation of PAs for diabetes mellitus (DM).

\hypertarget{defining-the-set-of-cohorts-to-evaluate}{%
\subsection{Defining the set of cohorts to
evaluate}\label{defining-the-set-of-cohorts-to-evaluate}}

The first step is to define the set of cohorts for which we wish to
determine performance characteristics. We do this by creating a data
frame with five columns:

\begin{itemize}
\tightlist
\item
  \textbf{atlasId}: The cohort ID in ATLAS.
\item
  \textbf{atlasName}: The full name of the cohort.
\item
  \textbf{cohortId}: The cohort ID to use in the package. Usually the
  same as the cohort ID in ATLAS.
\item
  \textbf{name}: A short name for the cohort, to use to create file
  names. do not use special characters.
\item
  \textbf{washoutPeriod}: washoutPeriod: The mininum required continuous
  observation time prior to index date for subjects within the cohort to
  test.
\end{itemize}

A convenient way to create such a data frame is to create a CSV file,
and load it into R. Here is an example table we assume is stored in
\texttt{c:/myCohortFile.csv}:

atlasId,atlasName,cohortId,name,washoutPeriod\\
7142,Type 2 Diabetes 2 X,7142,Type2Diabetes,0\\
8339,Type 2 Diabetes 3 X,8339,Type2Diabetes,0\\
7143,Type 2 Diabetes 1 X IP,7143,Type2Diabetes,0\\
7144,Type 2 Diabetes 1 X IP 1st Position,7144,Type2Diabetes,0

We can read the table using:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cohortSetReference <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{"c:/myCohortFile.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{creating-the-extremely-specific-xspec-extremely-sensitive-xsens-and-prevalence-cohorts}{%
\subsection{Creating the Extremely Specific (xSpec), Extremely Sensitive
(xSens), and Prevalence
Cohorts}\label{creating-the-extremely-specific-xspec-extremely-sensitive-xsens-and-prevalence-cohorts}}

The extremely specific (xSpec), extremely sensitive (xSens), and
prevalence cohorts are developed using the ATLAS tool. The xSpec is a
cohort where the subjects in the cohort are likely to be positive for
the health outcome of interest (HOI) with a very high probability. This
may be achieved by requiring that subjects have multiple condition codes
for the HOI in their patient record. An
\href{http://www.ohdsi.org/web/atlas/\#/cohortdefinition/1769699}{example}
of this for DM is included in the OHDSI ATLAS repository. In this
example each subject has an initial condition code for DM. The cohort
definition further specifies that each subject also has a second code
for DM between 1 and 30 days after the initial DM code and 10 additional
DM codes in the rest of the patient record. This very specific algorithm
for DM ensures that the subjects in this cohort have a very high
probability for having the condition of DM. This PA also specifies that
subjects are required to have at least 365 days of observation in their
patient record.

An example of an xSens cohort is created by developing a PA that is very
sensitive for the HOI. The system uses the xSens cohort to create a set
of ``noisy'' negative subjects, i.e., subjects with a high likelihood of
not having the HOI. This group of subjects will be used in the model
building process and is described in detail below. An
\href{http://www.ohdsi.org/web/atlas/\#/cohortdefinition/1770120}{example}
of an xSens cohort for DM is also in the OHDSI ATLAS repository.

The system uses the prevalence cohort to provide a reasonable
approximation of the prevalence of the HOI in the population. This
improves the calibration of the predictive model. The system will use
the xSens cohort as the default if a prevalence cohort is not specified.
This group of subjects will be used in the model building process and is
described in detail below. An
\href{http://www.ohdsi.org/web/atlas/\#/cohortdefinition/1770119}{example}
of an prevalence cohort for DM is also in the OHDSI ATLAS repository.

\hypertarget{evaluating-phenotype-algorithms-for-chronic-health-conditions}{%
\subsection{Evaluating phenotype algorithms for chronic health
conditions}\label{evaluating-phenotype-algorithms-for-chronic-health-conditions}}

The function createChronicPhenotypeModel allows the user to perform a
complete analysis for determining the performance characteristics for
one or more phenotype algorithms (cohort defintions) for chronic health
conditions. This function initiates the process for the three major
steps in PheValuator, namely: * 1) Develop a diagnostic predictive model
for the health condition. * 2) Select a large, random set of subjects
from the dataset and use the model to determine the probability of each
of the subjects having the health condition. * 3) Determine the
performance characteristics for one or more phenotype algorithms to be
used in studies.

createChronicPhenotypeModel should have as inputs:

\begin{itemize}
\tightlist
\item
  connectionDetails - connectionDetails created using the function
  createConnectionDetails in the DatabaseConnector package.
\item
  cdmDatabaseSchema - The name of the database schema that contains the
  OMOP CDM instance. Requires read permissions to this database. On SQL
  Server, this should specify both the database and the schema, so for
  example `cdm\_instance.dbo'.
\item
  databaseId - Short name for the database (default=``TestDB'')
\item
  cohortDatabaseSchema - The name of the database schema that is the
  location where the cohort data used to define the at risk cohort is
  available. If cohortTable = DRUG\_ERA, cohortDatabaseSchema is not
  used by assumed to be cdmSchema. Requires read permissions to this
  database.
\item
  cohortDatabaseTable - The tablename that contains the at risk cohort.
  If cohortTable \textless{}\textgreater{} DRUG\_ERA, then expectation
  is cohortTable has format of COHORT table: cohort\_concept\_id,
  SUBJECT\_ID, COHORT\_START\_DATE, COHORT\_END\_DATE.
\item
  outDatabaseSchema - The name of a database schema where the user has
  write capability. A temporary cohort table will be created here.
\item
  modelOutputFileName - A string designation for the training model file
  Recommended structure: "Model\_(xSpec
  Name)\emph{(CDM)}(Qualifiers)\_(Analysis Date)``,
  e.g.,''Model\_10XStroke\_MyCDM\_Age18-62\_20190101" to designate the
  file was from a \textbf{Model}, built on the \textbf{10 X Stroke}
  xSpec, using the \textbf{MyCDM} database, including ages \textbf{18 to
  62}, and analyzed on \textbf{20190101}.
\item
  evaluationOutputFileName - A string designation for the evaluation
  cohort file.\\
  Recommended structure: "Evaluation\_(xSpec
  Name)\emph{(CDM)}(Qualifiers)\_(Analysis Date)``,
  e.g.,''Evaluation\_10XStroke\_MyCDM\_Age18-62\_20190101" to designate
  the file was from an \textbf{Evaluation}, built on the \textbf{10 X
  Stroke} xSpec, using the \textbf{MyCDM} database, including ages
  \textbf{18 to 62}, and analyzed on \textbf{20190101}
\item
  conditionName - A short name for the health outcome of interest, e.g.,
  ``Hypertension'' (default = ``HOI'')
\item
  xSpecCohort - The number of the ``extremely specific (xSpec)'' cohort
  definition id in the cohort table (for noisy positives)
\item
  xSensCohort - The number of the ``extremely sensitive (xSens)'' cohort
  definition id in the cohort table (used to estimate population
  prevalence and to exclude subjects from the noisy positives)
\item
  prevalenceCohort - The number of the cohort definition id to determine
  the disease prevalence, usually a super-set of the exclCohort
\item
  excludedConcepts - A list of conceptIds to exclude from
  featureExtraction which should include all concept\_ids used to create
  the xSpec and xSens cohorts
\item
  includedCovariateIds - A list of covariate IDs that should be
  restricted to (default=NULL)
\item
  addDescendantsToExclude - Should descendants of excluded concepts also
  be excluded? (default=FALSE)
\item
  mainPopulationCohort - The number of the cohort to be used as a base
  population for the model (default=NULL)
\item
  baseSampleSize - The maximum number of subjects in the evaluation
  cohort (default=2M)
\item
  lowerAgeLimit - The lower age for subjects in the model (default=NULL)
\item
  upperAgeLimit - The upper age for subjects in the model (default=NULL)
\item
  startDays - The days to include prior to the cohort start date. If the
  mainPopulationCohort = 0, this should be 0 (default=0)
\item
  endDays - The days to include after the cohort start date. By default
  this is set to include all the data in a subject's record
  (default=10000)
\item
  gender - The gender(s) to be included (default c(8507, 8532))
\item
  startDate - The starting date for including subjects in the model
  (default=NULL)
\item
  endDate - The ending date for including subjects in the model
  (default=NULL)
\item
  checkDates - Should dates be checked to remove future dates
  (default=TRUE)
\item
  cdmVersion - The CDM version of the database (default=5)
\item
  outFolder - The folder where the output files will be written
  (default=working directory)
\item
  savePlpData - Determines whether the large PLP data file is saved.
  Setting this to FALSE will reduce the use of disk space
  (default=FALSE)
\item
  createModel - Run the function to create the diagnostic predictive
  model (default=TRUE)
\item
  createEvaluationCohort - Run the function to create the evaluation
  cohort (default=TRUE)
\item
  cohortDefinitionsToTest - A dataframe with cohorts to analyze. Leave
  blank to not test any cohort definitions (default=Null). The dataframe
  must contain the following elements:
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi})}
\tightlist
\item
  atlasId: The cohort ID in ATLAS.
\item
  atlasName: The full name of the cohort.
\item
  cohortId: The cohort ID to use in the package. Usually the same as the
  cohort ID in ATLAS.
\item
  name: A short name for the cohort, to use to create file names. Do not
  use special characters.
\item
  washoutPeriod: The mininum required continuous observation time prior
  to index date for subjects within the cohort to test.
\end{enumerate}

The createChronicPhenotypeModel function will produce one or more of the
following artifacts (depending on the flags that were set):\\
1) A Patient Level Prediction file (in .rds format) containg the
information from the model building process\\
2) A Patient Level Prediction file (in .rds format) containg the
information from applying the model to the evaluation cohort\\
3) A csv file containing the results from the analysis of the phenotype
algorithms to be tested

For example:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{options}\NormalTok{(}\DataTypeTok{fftempdir =} \StringTok{"c:/temp/ff"}\NormalTok{) }\CommentTok{#place to store large temporary files}

\NormalTok{connectionDetails <-}\StringTok{ }\KeywordTok{createConnectionDetails}\NormalTok{(}\DataTypeTok{dbms =} \StringTok{"postgresql"}\NormalTok{,}
                                              \DataTypeTok{server =} \StringTok{"localhost/ohdsi"}\NormalTok{,}
                                              \DataTypeTok{user =} \StringTok{"joe"}\NormalTok{,}
                                              \DataTypeTok{password =} \StringTok{"supersecret"}\NormalTok{)}

\NormalTok{phenoTest <-}\StringTok{ }\KeywordTok{createChronicPhenotypeModel}\NormalTok{(}\DataTypeTok{connectionDetails =}\NormalTok{ connectionDetails,}
                \DataTypeTok{cdmDatabaseSchema =} \StringTok{"my_cdm_data"}\NormalTok{,}
                \DataTypeTok{databaseId =} \StringTok{"TestDB"}\NormalTok{,}
                \DataTypeTok{cohortDatabaseSchema =} \StringTok{"my_results"}\NormalTok{,}
                \DataTypeTok{cohortDatabaseTable =} \StringTok{"cohort"}\NormalTok{,}
                \DataTypeTok{outDatabaseSchema =} \StringTok{"scratch.dbo"}\NormalTok{, }\CommentTok{#a database schema with write access}
                \DataTypeTok{modelOutputFileName =} \StringTok{"Train_10XDM_MyCDM_18-62_20190101"}\NormalTok{,}
                \DataTypeTok{evaluationOutputFileName =} \StringTok{"Eval_10XDM_MyCDM_18-62_20190101"}\NormalTok{,}
                \DataTypeTok{conditionName =} \StringTok{"Diabetes"}\NormalTok{,}
                \DataTypeTok{xSpecCohort =} \DecValTok{1769699}\NormalTok{,}
                \DataTypeTok{xSensCohort =} \DecValTok{1770120}\NormalTok{,}
                \DataTypeTok{prevalenceCohort =} \DecValTok{1770120}\NormalTok{,}
                \DataTypeTok{excludedConcepts =} \KeywordTok{c}\NormalTok{(}\DecValTok{201820}\NormalTok{), }
                \DataTypeTok{includedCovariateIds =} \KeywordTok{c}\NormalTok{(),}
                \DataTypeTok{addDescendantsToExclude =} \OtherTok{TRUE}\NormalTok{,}
                \DataTypeTok{mainPopulationCohort =} \DecValTok{0}\NormalTok{, }\CommentTok{#use the entire subject population}
                \DataTypeTok{baseSampleSize =} \DecValTok{2000000}\NormalTok{,}
                \DataTypeTok{lowerAgeLimit =} \DecValTok{18}\NormalTok{, }
                \DataTypeTok{upperAgeLimit =} \DecValTok{90}\NormalTok{,}
                \DataTypeTok{startDays =} \DecValTok{0}\NormalTok{, }\CommentTok{#from the start of the subject's record}
                \DataTypeTok{endDays =} \DecValTok{10000}\NormalTok{, }\CommentTok{#to the end of the subject's record}
                \DataTypeTok{gender =} \KeywordTok{c}\NormalTok{(}\DecValTok{8507}\NormalTok{, }\DecValTok{8532}\NormalTok{),}
                \DataTypeTok{startDate =} \StringTok{"19000101"}\NormalTok{,}
                \DataTypeTok{endDate =} \StringTok{"21000101"}\NormalTok{,}
                \DataTypeTok{checkDates =} \OtherTok{TRUE}\NormalTok{,}
                \DataTypeTok{outFolder =} \StringTok{"c:/phenotyping"}\NormalTok{,}
                \DataTypeTok{savePlpData =} \OtherTok{FALSE}\NormalTok{, }\CommentTok{#will preserve disk space}
                \DataTypeTok{createModel =} \OtherTok{TRUE}\NormalTok{, }\CommentTok{#will create a model}
                \DataTypeTok{createEvaluationCohort =} \OtherTok{TRUE}\NormalTok{, }\CommentTok{#will create an evaluation cohort}
                \DataTypeTok{cohortDefinitionsToTest =}\NormalTok{ cohortSetReference)}
\end{Highlighting}
\end{Shaded}

In this example, we used the cohorts developed in the ``my\_results''
cdm, specifying the location of the cohort table (cohortDatabaseSchema,
cohortDatabaseTable - ``my\_results.cohort'') and where the model will
find the conditions, drug exposures, etc. to inform the model
(cdmDatabaseSchema - ``my\_cdm\_data''). The subjects included in the
model will be those whose first visit in the CDM is between January 1,
2010 and December 31, 2017. We are also specifically excluding the
concept ID 201826, ``Type 2 diabetes mellitus'', which was used to
create the xSpec cohort as well as all of the descendants of that
concept ID. Their ages at the time of first visit will be between 18 and
90. The dataframe, cohortSetReference (see first section of this
vignette), is now used to define the cohort definitions for which we
want performance characteristics.

In this example, the parameters specify that the function will create
the model file:\\
``c:/phenotyping/Train\_10XDM\_MyCDM\_18-62\_20190101.rds'',

produce the evaluation cohort file:\\
``c:/phenotyping/Eval\_10XDM\_MyCDM\_18-62\_20190101.rds''

and produce the phenotype algorithm performance characteristics result
file:\\
``c:/phenotyping/PerformanceResultsDiabetes\_TestDB.csv''

\hypertarget{evaluating-phenotype-algorithms-for-acute-health-conditions-those-requiring-an-in-patient-hospital-visit}{%
\subsection{Evaluating phenotype algorithms for acute health conditions
(those requiring an in-patient hospital
visit)}\label{evaluating-phenotype-algorithms-for-acute-health-conditions-those-requiring-an-in-patient-hospital-visit}}

The function createAcutePhenotypeModel allows the user to perform a
complete analysis for determining the performance characteristics for
one or more phenotype algorithms (cohort defintions) for acute health
conditions. This function initiates the process for the three major
steps in PheValuator, namely: * 1) Develop a diagnostic predictive model
for the health condition. * 2) Select a large, random set of subjects
from the dataset and use the model to determine the probability of each
of the subjects having the health condition. * 3) Determine the
performance characteristics for one or more phenotype algorithms to be
used in studies.

createAcutePhenotypeModel should have the same inputs as described for
createAcutePhenotypeModel above but with more attention paid to the
following parameters: * startDays - The days to include prior to the
cohort start date. For acute health conditions, this will be the number
of days preceding the in-patient hospital visit. (default=0) * endDays -
The days to include after the cohort start date. (default=7, i.e., 7
days after the start of the hospital visit) * visitLength - The minimum
length of index visit for noisy negative comparison (default=3 days). As
a guideline, use the average length of a hospital visit for those with
the health condition.

For example:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{options}\NormalTok{(}\DataTypeTok{fftempdir =} \StringTok{"c:/temp/ff"}\NormalTok{) }\CommentTok{#place to store large temporary files}

\NormalTok{connectionDetails <-}\StringTok{ }\KeywordTok{createConnectionDetails}\NormalTok{(}\DataTypeTok{dbms =} \StringTok{"postgresql"}\NormalTok{,}
                                              \DataTypeTok{server =} \StringTok{"localhost/ohdsi"}\NormalTok{,}
                                              \DataTypeTok{user =} \StringTok{"joe"}\NormalTok{,}
                                              \DataTypeTok{password =} \StringTok{"supersecret"}\NormalTok{)}

\NormalTok{phenoTest <-}\StringTok{ }\KeywordTok{createAcutePhenotypeModel}\NormalTok{(}\DataTypeTok{connectionDetails =}\NormalTok{ connectionDetails,}
                \DataTypeTok{cdmDatabaseSchema =} \StringTok{"my_cdm_data"}\NormalTok{,}
                \DataTypeTok{databaseId =} \StringTok{"TestDB"}\NormalTok{,}
                \DataTypeTok{cohortDatabaseSchema =} \StringTok{"my_results"}\NormalTok{,}
                \DataTypeTok{cohortDatabaseTable =} \StringTok{"cohort"}\NormalTok{,}
                \DataTypeTok{outDatabaseSchema =} \StringTok{"scratch.dbo"}\NormalTok{, }\CommentTok{#a database schema with write access}
                \DataTypeTok{modelOutputFileName =} \StringTok{"Train_Pneumonia_MyCDM_18-62_20190101"}\NormalTok{,}
                \DataTypeTok{evaluationOutputFileName =} \StringTok{"Eval_Pneumonia_MyCDM_18-62_20190101"}\NormalTok{,}
                \DataTypeTok{conditionName =} \StringTok{"Pneumonia"}\NormalTok{,}
                \DataTypeTok{xSpecCohort =} \DecValTok{1769699}\NormalTok{,}
                \DataTypeTok{xSensCohort =} \DecValTok{1770120}\NormalTok{,}
                \DataTypeTok{prevalenceCohort =} \DecValTok{1770120}\NormalTok{,}
                \DataTypeTok{excludedConcepts =} \KeywordTok{c}\NormalTok{(}\DecValTok{255848}\NormalTok{), }
                \DataTypeTok{includedCovariateIds =} \KeywordTok{c}\NormalTok{(),}
                \DataTypeTok{addDescendantsToExclude =} \OtherTok{TRUE}\NormalTok{,}
                \DataTypeTok{mainPopulationCohort =} \DecValTok{0}\NormalTok{, }\CommentTok{#use the entire subject population}
                \DataTypeTok{baseSampleSize =} \DecValTok{2000000}\NormalTok{,}
                \DataTypeTok{lowerAgeLimit =} \DecValTok{18}\NormalTok{, }
                \DataTypeTok{upperAgeLimit =} \DecValTok{90}\NormalTok{,}
                \DataTypeTok{startDays =} \DecValTok{0}\NormalTok{, }\CommentTok{#from the start of the subject's record}
                \DataTypeTok{endDays =} \DecValTok{7}\NormalTok{, }\CommentTok{#to the end of the subject's record}
                \DataTypeTok{visitLength =} \DecValTok{3}\NormalTok{,}
                \DataTypeTok{gender =} \KeywordTok{c}\NormalTok{(}\DecValTok{8507}\NormalTok{, }\DecValTok{8532}\NormalTok{),}
                \DataTypeTok{startDate =} \StringTok{"19000101"}\NormalTok{,}
                \DataTypeTok{endDate =} \StringTok{"21000101"}\NormalTok{,}
                \DataTypeTok{checkDates =} \OtherTok{TRUE}\NormalTok{,}
                \DataTypeTok{outFolder =} \StringTok{"c:/phenotyping"}\NormalTok{,}
                \DataTypeTok{savePlpData =} \OtherTok{FALSE}\NormalTok{, }\CommentTok{#will preserve disk space}
                \DataTypeTok{createModel =} \OtherTok{TRUE}\NormalTok{, }\CommentTok{#will create a model}
                \DataTypeTok{createEvaluationCohort =} \OtherTok{TRUE}\NormalTok{, }\CommentTok{#will create an evaluation cohort}
                \DataTypeTok{cohortDefinitionsToTest =}\NormalTok{ cohortSetReference)}
\end{Highlighting}
\end{Shaded}

In this example, we are using only the expected value (``EV''). Given
that parameter setting, the output from this step will provide
performance characteristics (i.e, sensitivity, specificity, etc.) at
each prediction threshold as well as those using the expected value
calculations as described in the \href{vignettes/Figure2.png}{Step 2
diagram}. The evaluation uses the prediction information for the
evaluation cohort developed in the prior step. The data frames produced
from this step may be saved to a csv file for detailed examination.

\end{document}
